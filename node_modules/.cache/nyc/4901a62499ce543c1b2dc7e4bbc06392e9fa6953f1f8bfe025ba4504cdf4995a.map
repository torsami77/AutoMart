{"version":3,"sources":["signUp.js"],"names":["app","use","bodyParser","json","urlencoded","extended","text","type","signUp","req","res","body","username","firstName","lastName","address","checker","i","forEach","item","replace","toLowerCase","email","password","verify","mailformat","undefined","status","send","error","success","field","match","length","db","users","map","user","bcrypt","hash","token","jwt","sign","process","env","SECRET_KEY","expiresIn","newUser","id","parseInt","first_name","last_name","is_admin","created_on","Date","push","cookie","data","message"],"mappings":"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","sourceRoot":"/home/sami/Documents/AutoMart/src/ctl","sourcesContent":["import express from 'express';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport bodyParser from 'body-parser';\nimport db from '../db/db';\n\nconst app = express();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.text());\napp.use(bodyParser.json({ type: 'application/json' }));\n\n\nconst signUp = (req, res) => {\n  let {\n    username, firstName, lastName, address,\n  } = req.body;\n  let checker = [username, firstName, lastName, address];\n\n  let i = -1;\n  checker.forEach((item) => {\n    i += 1;\n    if (item !== '' && typeof (item) !== 'undefined') {\n      checker[i] = item.replace(/[^0-9A-Za-z,]/g, '').toLowerCase();\n    }\n  });\n\n  [username, firstName, lastName, address] = checker;\n\n\n  const {\n    email, password, verify,\n  } = req.body;\n  const mailformat = /^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/;\n\n  if (undefined === username || username === '') {\n    return res.status(401).send({\n      status: 401,\n      error: 'Please Provide a Username',\n      success: 'false',\n      field: 'username',\n    });\n  }\n\n  if (undefined === email || !email.match(mailformat)) {\n    return res.status(401).send({\n      status: 401,\n      error: 'Please Enter a Valid Email',\n      success: 'false',\n      field: 'email',\n    });\n  }\n\n  if (undefined === firstName || firstName === '') {\n    return res.status(401).send({\n      status: 401,\n      error: 'Please Enter your First Name',\n      success: 'false',\n      field: 'first-name',\n    });\n  }\n\n\n  if (undefined === lastName || lastName === '') {\n    return res.status(401).send({\n      status: 401,\n      error: 'Please Enter your Last Name',\n      success: 'false',\n      field: 'last-name',\n    });\n  }\n\n  if (undefined === address || address === '') {\n    return res.status(401).send({\n      status: 401,\n      error: 'Please Enter your Address',\n      success: 'false',\n      field: 'username',\n    });\n  }\n\n  if (undefined === password || password === '') {\n    return res.status(400).send({\n      status: 400,\n      error: 'Please Provide a Password',\n      success: 'false',\n      field: 'password',\n    });\n  }\n\n  if (undefined !== password && password.length < 8) {\n    return res.status(400).send({\n      status: 400,\n      error: 'Password is Too Short!',\n      success: 'false',\n      field: 'password',\n    });\n  }\n\n  if (verify !== password) {\n    return res.status(400).send({\n      status: 400,\n      error: 'Verifiable Password Does not Match!',\n      success: 'false',\n      field: 'password',\n    });\n  }\n\n  db.users.map((user) => {\n    if (user.email === email) {\n      return res.status(401).send({\n        status: 401,\n        error: 'Email is associated with another user!',\n        success: 'false',\n        field: 'email',\n      });\n    }\n    if (user.username === username) {\n      return res.status(401).send({\n        status: 401,\n        error: 'Username already taken by another user!',\n        success: 'false',\n        field: 'username',\n      });\n    }\n    bcrypt.hash(password, 10, (error, hash) => {\n      if (error) {\n        return res.status(401).send({\n          status: 404,\n          error,\n          field: 'password',\n        });\n      }\n\n      const token = jwt.sign({\n        email,\n        hash,\n      }, process.env.SECRET_KEY, { expiresIn: '1h' });\n\n      const newUser = {\n        id: parseInt(db.users.length + 1, 10),\n        email,\n        first_name: firstName,\n        last_name: lastName,\n        password: hash,\n        address,\n        is_admin: false,\n        created_on: new Date(),\n      };\n      db.users.push(newUser);\n\n      res.cookie('username', username);\n      res.cookie('token', token);\n      return res.status(201).send({\n        status: 201,\n        data: {\n          id: newUser.id,\n          token,\n          first_name: newUser.first_name,\n          last_name: newUser.last_name,\n          email: newUser.email,\n          success: 'true',\n          message: 'Your Signed up was successful',\n        },\n      });\n    });\n    return false;\n  });\n  return false;\n};\n\nexport default signUp;\n"]}