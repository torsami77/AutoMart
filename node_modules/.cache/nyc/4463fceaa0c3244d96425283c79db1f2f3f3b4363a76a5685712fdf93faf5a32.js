"use strict";var cov_1po5cmpyja=function(){var path="/home/sami/Documents/AutoMart/src/ctl/signUp.js";var hash="2a5949c7d0304b433f6df5825838aa2b7d8bac1c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/sami/Documents/AutoMart/src/ctl/signUp.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:28}},"2":{start:{line:8,column:15},end:{line:8,column:57}},"3":{start:{line:10,column:16},end:{line:10,column:59}},"4":{start:{line:12,column:20},end:{line:12,column:67}},"5":{start:{line:14,column:18},end:{line:14,column:64}},"6":{start:{line:16,column:10},end:{line:16,column:53}},"7":{start:{line:18,column:39},end:{line:18,column:95}},"8":{start:{line:20,column:10},end:{line:20,column:36}},"9":{start:{line:21,column:0},end:{line:21,column:39}},"10":{start:{line:22,column:0},end:{line:24,column:4}},"11":{start:{line:25,column:0},end:{line:25,column:39}},"12":{start:{line:26,column:0},end:{line:28,column:4}},"13":{start:{line:30,column:13},end:{line:190,column:1}},"14":{start:{line:31,column:18},end:{line:31,column:26}},"15":{start:{line:32,column:17},end:{line:32,column:35}},"16":{start:{line:33,column:18},end:{line:33,column:37}},"17":{start:{line:34,column:17},end:{line:34,column:35}},"18":{start:{line:35,column:16},end:{line:35,column:33}},"19":{start:{line:37,column:19},end:{line:37,column:27}},"20":{start:{line:38,column:14},end:{line:38,column:30}},"21":{start:{line:39,column:17},end:{line:39,column:36}},"22":{start:{line:40,column:15},end:{line:40,column:32}},"23":{start:{line:41,column:19},end:{line:41,column:64}},"24":{start:{line:43,column:2},end:{line:50,column:3}},"25":{start:{line:44,column:4},end:{line:49,column:7}},"26":{start:{line:52,column:2},end:{line:59,column:3}},"27":{start:{line:53,column:4},end:{line:58,column:7}},"28":{start:{line:61,column:2},end:{line:68,column:3}},"29":{start:{line:62,column:4},end:{line:67,column:7}},"30":{start:{line:70,column:2},end:{line:77,column:3}},"31":{start:{line:71,column:4},end:{line:76,column:7}},"32":{start:{line:79,column:2},end:{line:86,column:3}},"33":{start:{line:80,column:4},end:{line:85,column:7}},"34":{start:{line:88,column:2},end:{line:95,column:3}},"35":{start:{line:89,column:4},end:{line:94,column:7}},"36":{start:{line:97,column:2},end:{line:104,column:3}},"37":{start:{line:98,column:4},end:{line:103,column:7}},"38":{start:{line:106,column:2},end:{line:113,column:3}},"39":{start:{line:107,column:4},end:{line:112,column:7}},"40":{start:{line:115,column:20},end:{line:117,column:4}},"41":{start:{line:116,column:4},end:{line:116,column:32}},"42":{start:{line:119,column:23},end:{line:121,column:4}},"43":{start:{line:120,column:4},end:{line:120,column:38}},"44":{start:{line:123,column:2},end:{line:130,column:3}},"45":{start:{line:124,column:4},end:{line:129,column:7}},"46":{start:{line:132,column:2},end:{line:139,column:3}},"47":{start:{line:133,column:4},end:{line:138,column:7}},"48":{start:{line:141,column:2},end:{line:187,column:5}},"49":{start:{line:142,column:4},end:{line:148,column:5}},"50":{start:{line:143,column:6},end:{line:147,column:9}},"51":{start:{line:150,column:13},end:{line:150,column:58}},"52":{start:{line:152,column:16},end:{line:158,column:6}},"53":{start:{line:160,column:18},end:{line:169,column:5}},"54":{start:{line:171,column:4},end:{line:171,column:39}},"55":{start:{line:173,column:4},end:{line:173,column:37}},"56":{start:{line:174,column:4},end:{line:174,column:31}},"57":{start:{line:175,column:4},end:{line:186,column:7}},"58":{start:{line:189,column:2},end:{line:189,column:15}},"59":{start:{line:192,column:15},end:{line:192,column:21}},"60":{start:{line:193,column:0},end:{line:193,column:30}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:18,column:9},end:{line:18,column:31}},loc:{start:{line:18,column:37},end:{line:18,column:97}},line:18},"1":{name:"signUp",decl:{start:{line:30,column:22},end:{line:30,column:28}},loc:{start:{line:30,column:39},end:{line:190,column:1}},line:30},"2":{name:"(anonymous_2)",decl:{start:{line:115,column:46},end:{line:115,column:47}},loc:{start:{line:115,column:62},end:{line:117,column:3}},line:115},"3":{name:"(anonymous_3)",decl:{start:{line:119,column:49},end:{line:119,column:50}},loc:{start:{line:119,column:65},end:{line:121,column:3}},line:119},"4":{name:"(anonymous_4)",decl:{start:{line:141,column:42},end:{line:141,column:43}},loc:{start:{line:141,column:65},end:{line:187,column:3}},line:141}},branchMap:{"0":{loc:{start:{line:18,column:46},end:{line:18,column:94}},type:"cond-expr",locations:[{start:{line:18,column:70},end:{line:18,column:73}},{start:{line:18,column:76},end:{line:18,column:94}}],line:18},"1":{loc:{start:{line:18,column:46},end:{line:18,column:67}},type:"binary-expr",locations:[{start:{line:18,column:46},end:{line:18,column:49}},{start:{line:18,column:53},end:{line:18,column:67}}],line:18},"2":{loc:{start:{line:43,column:2},end:{line:50,column:3}},type:"if",locations:[{start:{line:43,column:2},end:{line:50,column:3}},{start:{line:43,column:2},end:{line:50,column:3}}],line:43},"3":{loc:{start:{line:43,column:6},end:{line:43,column:47}},type:"binary-expr",locations:[{start:{line:43,column:6},end:{line:43,column:28}},{start:{line:43,column:32},end:{line:43,column:47}}],line:43},"4":{loc:{start:{line:52,column:2},end:{line:59,column:3}},type:"if",locations:[{start:{line:52,column:2},end:{line:59,column:3}},{start:{line:52,column:2},end:{line:59,column:3}}],line:52},"5":{loc:{start:{line:52,column:6},end:{line:52,column:53}},type:"binary-expr",locations:[{start:{line:52,column:6},end:{line:52,column:25}},{start:{line:52,column:29},end:{line:52,column:53}}],line:52},"6":{loc:{start:{line:61,column:2},end:{line:68,column:3}},type:"if",locations:[{start:{line:61,column:2},end:{line:68,column:3}},{start:{line:61,column:2},end:{line:68,column:3}}],line:61},"7":{loc:{start:{line:61,column:6},end:{line:61,column:50}},type:"binary-expr",locations:[{start:{line:61,column:6},end:{line:61,column:29}},{start:{line:61,column:33},end:{line:61,column:50}}],line:61},"8":{loc:{start:{line:70,column:2},end:{line:77,column:3}},type:"if",locations:[{start:{line:70,column:2},end:{line:77,column:3}},{start:{line:70,column:2},end:{line:77,column:3}}],line:70},"9":{loc:{start:{line:70,column:6},end:{line:70,column:48}},type:"binary-expr",locations:[{start:{line:70,column:6},end:{line:70,column:28}},{start:{line:70,column:32},end:{line:70,column:48}}],line:70},"10":{loc:{start:{line:79,column:2},end:{line:86,column:3}},type:"if",locations:[{start:{line:79,column:2},end:{line:86,column:3}},{start:{line:79,column:2},end:{line:86,column:3}}],line:79},"11":{loc:{start:{line:79,column:6},end:{line:79,column:46}},type:"binary-expr",locations:[{start:{line:79,column:6},end:{line:79,column:27}},{start:{line:79,column:31},end:{line:79,column:46}}],line:79},"12":{loc:{start:{line:88,column:2},end:{line:95,column:3}},type:"if",locations:[{start:{line:88,column:2},end:{line:95,column:3}},{start:{line:88,column:2},end:{line:95,column:3}}],line:88},"13":{loc:{start:{line:88,column:6},end:{line:88,column:48}},type:"binary-expr",locations:[{start:{line:88,column:6},end:{line:88,column:28}},{start:{line:88,column:32},end:{line:88,column:48}}],line:88},"14":{loc:{start:{line:97,column:2},end:{line:104,column:3}},type:"if",locations:[{start:{line:97,column:2},end:{line:104,column:3}},{start:{line:97,column:2},end:{line:104,column:3}}],line:97},"15":{loc:{start:{line:97,column:6},end:{line:97,column:51}},type:"binary-expr",locations:[{start:{line:97,column:6},end:{line:97,column:28}},{start:{line:97,column:32},end:{line:97,column:51}}],line:97},"16":{loc:{start:{line:106,column:2},end:{line:113,column:3}},type:"if",locations:[{start:{line:106,column:2},end:{line:113,column:3}},{start:{line:106,column:2},end:{line:113,column:3}}],line:106},"17":{loc:{start:{line:123,column:2},end:{line:130,column:3}},type:"if",locations:[{start:{line:123,column:2},end:{line:130,column:3}},{start:{line:123,column:2},end:{line:130,column:3}}],line:123},"18":{loc:{start:{line:132,column:2},end:{line:139,column:3}},type:"if",locations:[{start:{line:132,column:2},end:{line:139,column:3}},{start:{line:132,column:2},end:{line:139,column:3}}],line:132},"19":{loc:{start:{line:142,column:4},end:{line:148,column:5}},type:"if",locations:[{start:{line:142,column:4},end:{line:148,column:5}},{start:{line:142,column:4},end:{line:148,column:5}}],line:142}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"2a5949c7d0304b433f6df5825838aa2b7d8bac1c"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();cov_1po5cmpyja.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1po5cmpyja.s[1]++;exports["default"]=void 0;var _express=(cov_1po5cmpyja.s[2]++,_interopRequireDefault(require("express")));var _bcryptjs=(cov_1po5cmpyja.s[3]++,_interopRequireDefault(require("bcryptjs")));var _jsonwebtoken=(cov_1po5cmpyja.s[4]++,_interopRequireDefault(require("jsonwebtoken")));var _bodyParser=(cov_1po5cmpyja.s[5]++,_interopRequireDefault(require("body-parser")));var _db=(cov_1po5cmpyja.s[6]++,_interopRequireDefault(require("../db/db")));function _interopRequireDefault(obj){cov_1po5cmpyja.f[0]++;cov_1po5cmpyja.s[7]++;return(cov_1po5cmpyja.b[1][0]++,obj)&&(cov_1po5cmpyja.b[1][1]++,obj.__esModule)?(cov_1po5cmpyja.b[0][0]++,obj):(cov_1po5cmpyja.b[0][1]++,{"default":obj});}var app=(cov_1po5cmpyja.s[8]++,(0,_express["default"])());cov_1po5cmpyja.s[9]++;app.use(_bodyParser["default"].json());cov_1po5cmpyja.s[10]++;app.use(_bodyParser["default"].urlencoded({extended:false}));cov_1po5cmpyja.s[11]++;app.use(_bodyParser["default"].text());cov_1po5cmpyja.s[12]++;app.use(_bodyParser["default"].json({type:'application/json'}));cov_1po5cmpyja.s[13]++;var signUp=function signUp(req,res){cov_1po5cmpyja.f[1]++;var _req$body=(cov_1po5cmpyja.s[14]++,req.body),username=(cov_1po5cmpyja.s[15]++,_req$body.username),firstName=(cov_1po5cmpyja.s[16]++,_req$body.firstName),lastName=(cov_1po5cmpyja.s[17]++,_req$body.lastName),address=(cov_1po5cmpyja.s[18]++,_req$body.address);// eslint-disable-next-line prefer-const
var _req$body2=(cov_1po5cmpyja.s[19]++,req.body),email=(cov_1po5cmpyja.s[20]++,_req$body2.email),password=(cov_1po5cmpyja.s[21]++,_req$body2.password),verify=(cov_1po5cmpyja.s[22]++,_req$body2.verify);var mailformat=(cov_1po5cmpyja.s[23]++,/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/);cov_1po5cmpyja.s[24]++;if((cov_1po5cmpyja.b[3][0]++,undefined===username)||(cov_1po5cmpyja.b[3][1]++,username==='')){cov_1po5cmpyja.b[2][0]++;cov_1po5cmpyja.s[25]++;return res.status(401).send({status:401,error:'Please Provide a Username',success:'false',field:'username'});}else{cov_1po5cmpyja.b[2][1]++;}cov_1po5cmpyja.s[26]++;if((cov_1po5cmpyja.b[5][0]++,undefined===email)||(cov_1po5cmpyja.b[5][1]++,!email.match(mailformat))){cov_1po5cmpyja.b[4][0]++;cov_1po5cmpyja.s[27]++;return res.status(401).send({status:401,error:'Please Enter a Valid Email',success:'false',field:'email'});}else{cov_1po5cmpyja.b[4][1]++;}cov_1po5cmpyja.s[28]++;if((cov_1po5cmpyja.b[7][0]++,undefined===firstName)||(cov_1po5cmpyja.b[7][1]++,firstName===' ')){cov_1po5cmpyja.b[6][0]++;cov_1po5cmpyja.s[29]++;return res.status(401).send({status:401,error:'Please Enter your First Name',success:'false',field:'first-name'});}else{cov_1po5cmpyja.b[6][1]++;}cov_1po5cmpyja.s[30]++;if((cov_1po5cmpyja.b[9][0]++,undefined===lastName)||(cov_1po5cmpyja.b[9][1]++,lastName===' ')){cov_1po5cmpyja.b[8][0]++;cov_1po5cmpyja.s[31]++;return res.status(401).send({status:401,error:'Please Enter your Last Name',success:'false',field:'last-name'});}else{cov_1po5cmpyja.b[8][1]++;}cov_1po5cmpyja.s[32]++;if((cov_1po5cmpyja.b[11][0]++,undefined===address)||(cov_1po5cmpyja.b[11][1]++,address===' ')){cov_1po5cmpyja.b[10][0]++;cov_1po5cmpyja.s[33]++;return res.status(401).send({status:401,error:'Please Enter your Address',success:'false',field:'username'});}else{cov_1po5cmpyja.b[10][1]++;}cov_1po5cmpyja.s[34]++;if((cov_1po5cmpyja.b[13][0]++,undefined===password)||(cov_1po5cmpyja.b[13][1]++,password===' ')){cov_1po5cmpyja.b[12][0]++;cov_1po5cmpyja.s[35]++;return res.status(401).send({status:401,error:'Please Provide a Password',success:'false',field:'password'});}else{cov_1po5cmpyja.b[12][1]++;}cov_1po5cmpyja.s[36]++;if((cov_1po5cmpyja.b[15][0]++,undefined!==password)&&(cov_1po5cmpyja.b[15][1]++,password.length<8)){cov_1po5cmpyja.b[14][0]++;cov_1po5cmpyja.s[37]++;return res.status(401).send({status:401,error:'Password is Too Short!',success:'false',field:'password'});}else{cov_1po5cmpyja.b[14][1]++;}cov_1po5cmpyja.s[38]++;if(verify!==password){cov_1po5cmpyja.b[16][0]++;cov_1po5cmpyja.s[39]++;return res.status(401).send({status:401,error:'Verifiable Password Does not Match!',success:'false',field:'password'});}else{cov_1po5cmpyja.b[16][1]++;}var emailSearch=(cov_1po5cmpyja.s[40]++,_db["default"].users.find(function(user){cov_1po5cmpyja.f[2]++;cov_1po5cmpyja.s[41]++;return user.email===email;}));var userNameSearch=(cov_1po5cmpyja.s[42]++,_db["default"].users.find(function(user){cov_1po5cmpyja.f[3]++;cov_1po5cmpyja.s[43]++;return user.username===username;}));cov_1po5cmpyja.s[44]++;if(emailSearch){cov_1po5cmpyja.b[17][0]++;cov_1po5cmpyja.s[45]++;return res.status(401).send({status:401,error:'Email is associated with another user!',success:'false',field:'email'});}else{cov_1po5cmpyja.b[17][1]++;}cov_1po5cmpyja.s[46]++;if(userNameSearch){cov_1po5cmpyja.b[18][0]++;cov_1po5cmpyja.s[47]++;return res.status(401).send({status:401,error:'Username already taken by another user!',success:'false',field:'username'});}else{cov_1po5cmpyja.b[18][1]++;}cov_1po5cmpyja.s[48]++;_bcryptjs["default"].hash(password,10,function(error,hash){cov_1po5cmpyja.f[4]++;cov_1po5cmpyja.s[49]++;if(error){cov_1po5cmpyja.b[19][0]++;cov_1po5cmpyja.s[50]++;return res.status(401).send({status:404,error:error,field:'password'});}else{cov_1po5cmpyja.b[19][1]++;}var id=(cov_1po5cmpyja.s[51]++,parseInt(_db["default"].users.length+1,10));var token=(cov_1po5cmpyja.s[52]++,_jsonwebtoken["default"].sign({email:email,hash:hash,id:id},process.env.SECRET_KEY,{expiresIn:'1h'}));var newUser=(cov_1po5cmpyja.s[53]++,{id:id,email:email,first_name:firstName,last_name:lastName,password:hash,address:address,is_admin:false,created_on:new Date()});cov_1po5cmpyja.s[54]++;_db["default"].users.push(newUser);cov_1po5cmpyja.s[55]++;res.cookie('username',username);cov_1po5cmpyja.s[56]++;res.cookie('token',token);cov_1po5cmpyja.s[57]++;return res.status(201).send({status:201,data:{id:newUser.id,token:token,first_name:newUser.first_name,last_name:newUser.last_name,email:newUser.email,success:'true',message:'Your Signed up was successful'}});});cov_1po5cmpyja.s[58]++;return false;};var _default=(cov_1po5cmpyja.s[59]++,signUp);cov_1po5cmpyja.s[60]++;exports["default"]=_default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNpZ25VcC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJ1c2UiLCJib2R5UGFyc2VyIiwianNvbiIsInVybGVuY29kZWQiLCJleHRlbmRlZCIsInRleHQiLCJ0eXBlIiwic2lnblVwIiwicmVxIiwicmVzIiwiYm9keSIsInVzZXJuYW1lIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJhZGRyZXNzIiwiZW1haWwiLCJwYXNzd29yZCIsInZlcmlmeSIsIm1haWxmb3JtYXQiLCJ1bmRlZmluZWQiLCJzdGF0dXMiLCJzZW5kIiwiZXJyb3IiLCJzdWNjZXNzIiwiZmllbGQiLCJtYXRjaCIsImxlbmd0aCIsImVtYWlsU2VhcmNoIiwiZGIiLCJ1c2VycyIsImZpbmQiLCJ1c2VyIiwidXNlck5hbWVTZWFyY2giLCJiY3J5cHQiLCJoYXNoIiwiaWQiLCJwYXJzZUludCIsInRva2VuIiwiand0Iiwic2lnbiIsInByb2Nlc3MiLCJlbnYiLCJTRUNSRVRfS0VZIiwiZXhwaXJlc0luIiwibmV3VXNlciIsImZpcnN0X25hbWUiLCJsYXN0X25hbWUiLCJpc19hZG1pbiIsImNyZWF0ZWRfb24iLCJEYXRlIiwicHVzaCIsImNvb2tpZSIsImRhdGEiLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSxHQUFHLEdBQUcsMEJBQVo7QUFFQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLHVCQUFXQyxJQUFYLEVBQVI7QUFDQUgsR0FBRyxDQUFDQyxHQUFKLENBQVFDLHVCQUFXRSxVQUFYLENBQXNCO0FBQUVDLEVBQUFBLFFBQVEsRUFBRTtBQUFaLENBQXRCLENBQVI7QUFDQUwsR0FBRyxDQUFDQyxHQUFKLENBQVFDLHVCQUFXSSxJQUFYLEVBQVI7QUFDQU4sR0FBRyxDQUFDQyxHQUFKLENBQVFDLHVCQUFXQyxJQUFYLENBQWdCO0FBQUVJLEVBQUFBLElBQUksRUFBRTtBQUFSLENBQWhCLENBQVI7O0FBR0EsSUFBTUMs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QSxFQURjO0FBRWRwQixNQUFBQSxLQUFLLEVBQUxBLEtBRmM7QUFHZDhCLE1BQUFBLFVBQVUsRUFBRWpDLFNBSEU7QUFJZGtDLE1BQUFBLFNBQVMsRUFBRWpDLFFBSkc7QUFLZEcsTUFBQUEsUUFBUSxFQUFFa0IsSUFMSTtBQU1kcEIsTUFBQUEsT0FBTyxFQUFQQSxPQU5jO0FBT2RpQyxNQUFBQSxRQUFRLEVBQUUsS0FQSTtBQVFkQyxNQUFBQSxVQUFVLEVBQUUsSUFBSUMsSUFBSjtBQVJFLEtBQWhCOztBQVVBckIsbUJBQUdDLEtBQUgsQ0FBU3FCLElBQVQsQ0FBY04sT0FBZDs7QUFFQW5DLElBQUFBLEdBQUcsQ0FBQzBDLE1BQUosQ0FBVyxVQUFYLEVBQXVCeEMsUUFBdkI7QUFDQUYsSUFBQUEsR0FBRyxDQUFDMEMsTUFBSixDQUFXLE9BQVgsRUFBb0JkLEtBQXBCO0FBQ0EsV0FBTzVCLEdBQUcsQ0FBQ1csTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCO0FBQzFCRCxNQUFBQSxNQUFNLEVBQUUsR0FEa0I7QUFFMUJnQyxNQUFBQSxJQUFJLEVBQUU7QUFDSmpCLFFBQUFBLEVBQUUsRUFBRVMsT0FBTyxDQUFDVCxFQURSO0FBRUpFLFFBQUFBLEtBQUssRUFBTEEsS0FGSTtBQUdKUSxRQUFBQSxVQUFVLEVBQUVELE9BQU8sQ0FBQ0MsVUFIaEI7QUFJSkMsUUFBQUEsU0FBUyxFQUFFRixPQUFPLENBQUNFLFNBSmY7QUFLSi9CLFFBQUFBLEtBQUssRUFBRTZCLE9BQU8sQ0FBQzdCLEtBTFg7QUFNSlEsUUFBQUEsT0FBTyxFQUFFLE1BTkw7QUFPSjhCLFFBQUFBLE9BQU8sRUFBRTtBQVBMO0FBRm9CLEtBQXJCLENBQVA7QUFZRCxHQXpDRDs7QUEwQ0EsU0FBTyxLQUFQO0FBQ0QsQ0FqSkQ7O2VBbUplOUMsTSIsInNvdXJjZVJvb3QiOiIvaG9tZS9zYW1pL0RvY3VtZW50cy9BdXRvTWFydC9zcmMvY3RsIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCBib2R5UGFyc2VyIGZyb20gJ2JvZHktcGFyc2VyJztcbmltcG9ydCBkYiBmcm9tICcuLi9kYi9kYic7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcblxuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiBmYWxzZSB9KSk7XG5hcHAudXNlKGJvZHlQYXJzZXIudGV4dCgpKTtcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKHsgdHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nIH0pKTtcblxuXG5jb25zdCBzaWduVXAgPSAocmVxLCByZXMpID0+IHtcbiAgbGV0IHtcbiAgICB1c2VybmFtZSwgZmlyc3ROYW1lLCBsYXN0TmFtZSwgYWRkcmVzcyxcbiAgfSA9IHJlcS5ib2R5O1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XG5cbiAgY29uc3Qge1xuICAgIGVtYWlsLCBwYXNzd29yZCwgdmVyaWZ5LFxuICB9ID0gcmVxLmJvZHk7XG4gIGNvbnN0IG1haWxmb3JtYXQgPSAvXlxcdysoWy4tXT9cXHcrKSpAXFx3KyhbLi1dP1xcdyspKihcXC5cXHd7MiwzfSkrJC87XG5cbiAgaWYgKHVuZGVmaW5lZCA9PT0gdXNlcm5hbWUgfHwgdXNlcm5hbWUgPT09ICcnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHtcbiAgICAgIHN0YXR1czogNDAxLFxuICAgICAgZXJyb3I6ICdQbGVhc2UgUHJvdmlkZSBhIFVzZXJuYW1lJyxcbiAgICAgIHN1Y2Nlc3M6ICdmYWxzZScsXG4gICAgICBmaWVsZDogJ3VzZXJuYW1lJyxcbiAgICB9KTtcbiAgfVxuXG4gIGlmICh1bmRlZmluZWQgPT09IGVtYWlsIHx8ICFlbWFpbC5tYXRjaChtYWlsZm9ybWF0KSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZCh7XG4gICAgICBzdGF0dXM6IDQwMSxcbiAgICAgIGVycm9yOiAnUGxlYXNlIEVudGVyIGEgVmFsaWQgRW1haWwnLFxuICAgICAgc3VjY2VzczogJ2ZhbHNlJyxcbiAgICAgIGZpZWxkOiAnZW1haWwnLFxuICAgIH0pO1xuICB9XG5cbiAgaWYgKHVuZGVmaW5lZCA9PT0gZmlyc3ROYW1lIHx8IGZpcnN0TmFtZSA9PT0gJyAnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHtcbiAgICAgIHN0YXR1czogNDAxLFxuICAgICAgZXJyb3I6ICdQbGVhc2UgRW50ZXIgeW91ciBGaXJzdCBOYW1lJyxcbiAgICAgIHN1Y2Nlc3M6ICdmYWxzZScsXG4gICAgICBmaWVsZDogJ2ZpcnN0LW5hbWUnLFxuICAgIH0pO1xuICB9XG5cblxuICBpZiAodW5kZWZpbmVkID09PSBsYXN0TmFtZSB8fCBsYXN0TmFtZSA9PT0gJyAnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHtcbiAgICAgIHN0YXR1czogNDAxLFxuICAgICAgZXJyb3I6ICdQbGVhc2UgRW50ZXIgeW91ciBMYXN0IE5hbWUnLFxuICAgICAgc3VjY2VzczogJ2ZhbHNlJyxcbiAgICAgIGZpZWxkOiAnbGFzdC1uYW1lJyxcbiAgICB9KTtcbiAgfVxuXG4gIGlmICh1bmRlZmluZWQgPT09IGFkZHJlc3MgfHwgYWRkcmVzcyA9PT0gJyAnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHtcbiAgICAgIHN0YXR1czogNDAxLFxuICAgICAgZXJyb3I6ICdQbGVhc2UgRW50ZXIgeW91ciBBZGRyZXNzJyxcbiAgICAgIHN1Y2Nlc3M6ICdmYWxzZScsXG4gICAgICBmaWVsZDogJ3VzZXJuYW1lJyxcbiAgICB9KTtcbiAgfVxuXG4gIGlmICh1bmRlZmluZWQgPT09IHBhc3N3b3JkIHx8IHBhc3N3b3JkID09PSAnICcpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoe1xuICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICBlcnJvcjogJ1BsZWFzZSBQcm92aWRlIGEgUGFzc3dvcmQnLFxuICAgICAgc3VjY2VzczogJ2ZhbHNlJyxcbiAgICAgIGZpZWxkOiAncGFzc3dvcmQnLFxuICAgIH0pO1xuICB9XG5cbiAgaWYgKHVuZGVmaW5lZCAhPT0gcGFzc3dvcmQgJiYgcGFzc3dvcmQubGVuZ3RoIDwgOCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZCh7XG4gICAgICBzdGF0dXM6IDQwMSxcbiAgICAgIGVycm9yOiAnUGFzc3dvcmQgaXMgVG9vIFNob3J0IScsXG4gICAgICBzdWNjZXNzOiAnZmFsc2UnLFxuICAgICAgZmllbGQ6ICdwYXNzd29yZCcsXG4gICAgfSk7XG4gIH1cblxuICBpZiAodmVyaWZ5ICE9PSBwYXNzd29yZCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZCh7XG4gICAgICBzdGF0dXM6IDQwMSxcbiAgICAgIGVycm9yOiAnVmVyaWZpYWJsZSBQYXNzd29yZCBEb2VzIG5vdCBNYXRjaCEnLFxuICAgICAgc3VjY2VzczogJ2ZhbHNlJyxcbiAgICAgIGZpZWxkOiAncGFzc3dvcmQnLFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgZW1haWxTZWFyY2ggPSBkYi51c2Vycy5maW5kKHVzZXIgPT4gdXNlci5lbWFpbCA9PT0gZW1haWwpO1xuICBjb25zdCB1c2VyTmFtZVNlYXJjaCA9IGRiLnVzZXJzLmZpbmQodXNlciA9PiB1c2VyLnVzZXJuYW1lID09PSB1c2VybmFtZSk7XG4gIGlmIChlbWFpbFNlYXJjaCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZCh7XG4gICAgICBzdGF0dXM6IDQwMSxcbiAgICAgIGVycm9yOiAnRW1haWwgaXMgYXNzb2NpYXRlZCB3aXRoIGFub3RoZXIgdXNlciEnLFxuICAgICAgc3VjY2VzczogJ2ZhbHNlJyxcbiAgICAgIGZpZWxkOiAnZW1haWwnLFxuICAgIH0pO1xuICB9XG4gIGlmICh1c2VyTmFtZVNlYXJjaCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZCh7XG4gICAgICBzdGF0dXM6IDQwMSxcbiAgICAgIGVycm9yOiAnVXNlcm5hbWUgYWxyZWFkeSB0YWtlbiBieSBhbm90aGVyIHVzZXIhJyxcbiAgICAgIHN1Y2Nlc3M6ICdmYWxzZScsXG4gICAgICBmaWVsZDogJ3VzZXJuYW1lJyxcbiAgICB9KTtcbiAgfVxuICBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTAsIChlcnJvciwgaGFzaCkgPT4ge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHtcbiAgICAgICAgc3RhdHVzOiA0MDQsXG4gICAgICAgIGVycm9yLFxuICAgICAgICBmaWVsZDogJ3Bhc3N3b3JkJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBpZCA9IHBhcnNlSW50KGRiLnVzZXJzLmxlbmd0aCArIDEsIDEwKTtcbiAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHtcbiAgICAgIGVtYWlsLFxuICAgICAgaGFzaCxcbiAgICAgIGlkLFxuICAgIH0sIHByb2Nlc3MuZW52LlNFQ1JFVF9LRVksIHsgZXhwaXJlc0luOiAnMWgnIH0pO1xuXG4gICAgY29uc3QgbmV3VXNlciA9IHtcbiAgICAgIGlkLFxuICAgICAgZW1haWwsXG4gICAgICBmaXJzdF9uYW1lOiBmaXJzdE5hbWUsXG4gICAgICBsYXN0X25hbWU6IGxhc3ROYW1lLFxuICAgICAgcGFzc3dvcmQ6IGhhc2gsXG4gICAgICBhZGRyZXNzLFxuICAgICAgaXNfYWRtaW46IGZhbHNlLFxuICAgICAgY3JlYXRlZF9vbjogbmV3IERhdGUoKSxcbiAgICB9O1xuICAgIGRiLnVzZXJzLnB1c2gobmV3VXNlcik7XG5cbiAgICByZXMuY29va2llKCd1c2VybmFtZScsIHVzZXJuYW1lKTtcbiAgICByZXMuY29va2llKCd0b2tlbicsIHRva2VuKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLnNlbmQoe1xuICAgICAgc3RhdHVzOiAyMDEsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiBuZXdVc2VyLmlkLFxuICAgICAgICB0b2tlbixcbiAgICAgICAgZmlyc3RfbmFtZTogbmV3VXNlci5maXJzdF9uYW1lLFxuICAgICAgICBsYXN0X25hbWU6IG5ld1VzZXIubGFzdF9uYW1lLFxuICAgICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgICAgc3VjY2VzczogJ3RydWUnLFxuICAgICAgICBtZXNzYWdlOiAnWW91ciBTaWduZWQgdXAgd2FzIHN1Y2Nlc3NmdWwnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHNpZ25VcDtcbiJdfQ==