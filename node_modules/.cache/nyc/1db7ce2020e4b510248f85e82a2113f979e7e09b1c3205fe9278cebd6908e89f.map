{"version":3,"sources":["viewer.js"],"names":["app","use","bodyParser","json","urlencoded","extended","text","type","Viewer","req","res","params","carId","isNaN","parseInt","status","send","error","success","field","data","db","cars","map","car","id","undefined","query","state","minPrice","maxPrice","manufacturer","model","bodyType","searchObjects","searchTerm","searchFields","forEach","item","push","arrOfSearch","Object","keys","keyItem","price","includes","length"],"mappings":"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","sourceRoot":"/home/sami/Documents/AutoMart/src/ctl","sourcesContent":["import express from 'express';\nimport bodyParser from 'body-parser';\nimport db from '../db/db';\n\nconst app = express();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.text());\napp.use(bodyParser.json({ type: 'application/json' }));\n\n\nclass Viewer {\n  static specificCar(req, res) {\n    if (!req.params.carId || isNaN(parseInt(req.params.carId, 10))) {\n      res.status(401).send({\n        status: 401,\n        error: 'Please provide a valid Ad reference!',\n        success: 'false',\n        field: 'car',\n      });\n      return false;\n    }\n    let data;\n    db.cars.map((car) => {\n      if (car.id === parseInt(req.params.carId, 10)) {\n        data = car;\n      }\n      return false;\n    });\n    if (undefined !== data) {\n      res.status(200).send({\n        status: 200,\n        data,\n        success: 'true',\n        field: 'car',\n      });\n      return false;\n    }\n    res.status(404).send({\n      status: 404,\n      error: 'Ad not found!',\n      success: 'false',\n      field: 'car',\n    });\n    return false;\n  }\n\n  static dynamicView(req, res) {\n    // eslint-disable-next-line object-curly-newline\n    let { status, state, minPrice, maxPrice, manufacturer, model, bodyType } = req.query;\n    //let { minPrice } = req.query;\n    // eslint-disable-next-line object-curly-newline\n    const searchObjects = { state, minPrice, maxPrice, manufacturer, model, bodyType };\n    const searchTerm = [state, minPrice, maxPrice, manufacturer, model, bodyType];\n    const searchFields = [];\n    searchTerm.forEach((item) => {\n      if (undefined !== item) {\n        searchFields.push(item);\n      }\n    });\n    const arrOfSearch = [];\n\n    if (status === 'available') {\n      if (undefined === minPrice) {\n        minPrice = 0;\n      }\n      if (maxPrice) {\n        db.cars.map((car) => {\n          Object.keys(searchObjects).forEach((keyItem) => {\n            if ((keyItem !== 'minPrice' || keyItem !== 'maxPrice') && car.price >= minPrice && car.price <= maxPrice && undefined !== car[keyItem] && car.status === 'available' && car[keyItem] === searchObjects[keyItem] && (!arrOfSearch.includes(car))) {\n              arrOfSearch.push(car);\n            }\n          });\n          return false;\n        });\n        if (undefined === arrOfSearch || arrOfSearch.length === 0) {\n          return res.status(404).send({\n            status: 404,\n            error: 'Your Search wasn\\'t not found',\n            success: 'false',\n            field: searchFields,\n          });\n        }\n      \n        if (undefined !== arrOfSearch && arrOfSearch.length !== 0) {\n          return res.status(200).send({\n            status: 200,\n            success: 'true',\n            data: arrOfSearch,\n          });\n        }\n      }\n      db.cars.map((car) => {\n        Object.keys(searchObjects).forEach((keyItem) => {\n          if (undefined !== car[keyItem] && car.status === 'available' && car[keyItem] === searchObjects[keyItem] && (!arrOfSearch.includes(car))) {\n            arrOfSearch.push(car);\n          }\n        });\n        return false;\n      });\n      if (undefined !== arrOfSearch && arrOfSearch.length !== 0) {\n        return res.status(200).send({\n          status: 200,\n          success: 'true',\n          data: arrOfSearch,\n        });\n      }\n\n      // if previous search conditions weren't thought, search returns all available Ad\n      db.cars.map((car) => {\n        if (car.status === 'available') {\n          arrOfSearch.push(car);\n        }\n        return false;\n      });\n      if (undefined === arrOfSearch || arrOfSearch.length === 0) {\n        return res.status(404).send({\n          status: 404,\n          error: 'Your Search wasn\\'t not found',\n          success: 'false',\n          field: searchFields,\n        });\n      }\n      return res.status(200).send({\n        status: 200,\n        success: 'true',\n        data: arrOfSearch,\n      });\n    }\n    // If status=available not specified, search falls back to admin's view all (sold and available)\n    // admin.viewAll(req, res);\n    return res.status(403).send({\n      status: 403,\n      error: 'You are not Admin',\n    });\n  }\n}\n\nexport default Viewer;\n"]}