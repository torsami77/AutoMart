{"version":3,"sources":["viewer.js"],"names":["app","use","bodyParser","json","urlencoded","extended","text","type","Viewer","req","res","body","carId","isNaN","parseInt","status","send","error","suceess","field","db","cars","map","car","id","data","success","query","state","minPrice","maxPrice","manufacturer","model","bodyType","searchObjects","searchTerm","searchFields","forEach","item","undefined","push","arrOfSearch","Object","keys","keyItem","price","includes","length"],"mappings":"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","sourceRoot":"/home/sami/Documents/AutoMart/src/ctl","sourcesContent":["import express from 'express';\nimport bodyParser from 'body-parser';\nimport db from '../db/db';\n\nconst app = express();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.text());\napp.use(bodyParser.json({ type: 'application/json' }));\n\n\nclass Viewer {\n  static specificCar(req, res) {\n    if (!req.body.carId || isNaN(parseInt(req.body.carId, 10))) {\n      return res.status(401).send({\n        status: 401,\n        error: 'Please provide a valid Ad reference!',\n        suceess: 'false',\n        field: 'car',\n      });\n    }\n    db.cars.map((car) => {\n      if (car.id === req.body.carId) {\n        return res.status(200).send({\n          status: 200,\n          data: car,\n          success: 'true',\n          field: 'car',\n        });\n      }\n      return res.status(404).send({\n        status: 404,\n        error: 'Ad not found!',\n        success: 'false',\n        field: 'car',\n      });\n    });\n    return false;\n  }\n\n  static dynamicView(req, res) {\n    // eslint-disable-next-line object-curly-newline\n    let { status, state, minPrice, maxPrice, manufacturer, model, bodyType } = req.query;\n    //let { minPrice } = req.query;\n    // eslint-disable-next-line object-curly-newline\n    const searchObjects = { state, minPrice, maxPrice, manufacturer, model, bodyType };\n    const searchTerm = [state, minPrice, maxPrice, manufacturer, model, bodyType];\n    const searchFields = [];\n    searchTerm.forEach((item) => {\n      if (undefined !== item) {\n        searchFields.push(item);\n      }\n    });\n    const arrOfSearch = [];\n\n    if (status === 'available') {\n      if (undefined === minPrice) {\n        minPrice = 0;\n      }\n      if (maxPrice) {\n        db.cars.map((car) => {\n          Object.keys(searchObjects).forEach((keyItem) => {\n            if ((keyItem !== 'minPrice' || keyItem !== 'maxPrice') && car.price >= minPrice && car.price <= maxPrice && undefined !== car[keyItem] && car.status === 'available' && car[keyItem] === searchObjects[keyItem] && (!arrOfSearch.includes(car))) {\n              arrOfSearch.push(car);\n            }\n          });\n          return false;\n        });\n        if (undefined === arrOfSearch || arrOfSearch.length === 0) {\n          return res.status(404).send({\n            status: 404,\n            error: 'Your Search wasn\\'t not found',\n            success: 'false',\n            field: searchFields,\n          });\n        }\n        if (undefined !== arrOfSearch && arrOfSearch.length !== 0) {\n          return res.status(200).send({\n            status: 200,\n            success: 'true',\n            data: arrOfSearch,\n          });\n        }\n      }\n\n      db.cars.map((car) => {\n        Object.keys(searchObjects).forEach((keyItem) => {\n          if (undefined !== car[keyItem] && car.status === 'available' && car[keyItem] === searchObjects[keyItem] && (!arrOfSearch.includes(car))) {\n            arrOfSearch.push(car);\n          }\n        });\n        return false;\n      });\n      if (undefined === arrOfSearch || arrOfSearch.length === 0) {\n        return res.status(404).send({\n          status: 404,\n          error: 'Your Search wasn\\'t not found',\n          success: 'false',\n          field: searchFields,\n        });\n      }\n      if (undefined !== arrOfSearch && arrOfSearch.length !== 0) {\n        return res.status(200).send({\n          status: 200,\n          success: 'true',\n          data: arrOfSearch,\n        });\n      }\n\n      // if previous search conditions weren't thought, search returns all available Ad\n      db.cars.map((car) => {\n        if (car.status === 'available') {\n          arrOfSearch.push(car);\n        }\n        return false;\n      });\n      if (undefined === arrOfSearch || arrOfSearch.length === 0) {\n        return res.status(404).send({\n          status: 404,\n          error: 'Your Search wasn\\'t not found',\n          success: 'false',\n          field: searchFields,\n        });\n      }\n      return res.status(200).send({\n        status: 200,\n        success: 'true',\n        data: arrOfSearch,\n      });\n    }\n    // If status=available not specified, search falls back to admin's view all (sold and available)\n    // admin.viewAll(req, res);\n    return res.status(403).send({\n      status: 403,\n      error: 'You are not Admin',\n    });\n  }\n}\n\nexport default Viewer;\n"]}